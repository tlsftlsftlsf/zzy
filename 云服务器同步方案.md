# åŸºäºäº‘æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ

## æ–¹æ¡ˆæ¶æ„
```
å‰ç«¯å•æ–‡ä»¶ -> äº‘æœåŠ¡å™¨API -> æœ¬åœ°æ•°æ®æ–‡ä»¶ -> å¤šè®¾å¤‡è®¿é—®
```

## æŠ€æœ¯å®ç°

### 1. äº‘æœåŠ¡å™¨ç«¯APIæœåŠ¡

#### Python Flaskå®ç°ï¼ˆæ¨èï¼‰
```python
# server.py - åœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œ
from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
import json
import os
from datetime import datetime

app = Flask(__name__)
CORS(app)  # å…è®¸è·¨åŸŸè®¿é—®

# æ•°æ®æ–‡ä»¶è·¯å¾„
DATA_FILE = '/var/www/points-data.json'
BACKUP_DIR = '/var/www/backups/'

@app.route('/api/upload', methods=['POST'])
def upload_data():
    try:
        data = request.json
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        
        # åˆ›å»ºå¤‡ä»½
        if os.path.exists(DATA_FILE):
            backup_path = f"{BACKUP_DIR}points-data_{timestamp}.json"
            os.makedirs(BACKUP_DIR, exist_ok=True)
            os.rename(DATA_FILE, backup_path)
        
        # ä¿å­˜æ–°æ•°æ®
        with open(DATA_FILE, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        
        return jsonify({'status': 'success', 'message': 'æ•°æ®ä¸Šä¼ æˆåŠŸ'})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)})

@app.route('/api/download', methods=['GET'])
def download_data():
    try:
        if os.path.exists(DATA_FILE):
            with open(DATA_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
            return jsonify({'status': 'success', 'data': data})
        else:
            return jsonify({'status': 'success', 'data': {}})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)})

@app.route('/api/backup', methods=['GET'])
def list_backups():
    try:
        if os.path.exists(BACKUP_DIR):
            backups = []
            for filename in os.listdir(BACKUP_DIR):
                if filename.endswith('.json'):
                    file_path = os.path.join(BACKUP_DIR, filename)
                    file_time = os.path.getmtime(file_path)
                    backups.append({
                        'filename': filename,
                        'timestamp': datetime.fromtimestamp(file_time).strftime('%Y-%m-%d %H:%M:%S')
                    })
            return jsonify({'status': 'success', 'backups': sorted(backups, key=lambda x: x['filename'], reverse=True)})
        else:
            return jsonify({'status': 'success', 'backups': []})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)})

@app.route('/api/restore/<filename>', methods=['POST'])
def restore_backup(filename):
    try:
        backup_path = os.path.join(BACKUP_DIR, filename)
        if os.path.exists(backup_path):
            with open(backup_path, 'r', encoding='utf-8') as f:
                data = json.load(f)
            return jsonify({'status': 'success', 'data': data})
        else:
            return jsonify({'status': 'error', 'message': 'å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨'})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
```

#### Node.js Expresså®ç°
```javascript
// server.js - åœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œ
const express = require('express');
const cors = require('cors');
const fs = require('fs');
const path = require('path');

const app = express();
app.use(cors());
app.use(express.json());

const DATA_FILE = '/var/www/points-data.json';
const BACKUP_DIR = '/var/www/backups/';

// ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨
if (!fs.existsSync(BACKUP_DIR)) {
    fs.mkdirSync(BACKUP_DIR, { recursive: true });
}

// ä¸Šä¼ æ•°æ®
app.post('/api/upload', (req, res) => {
    try {
        const data = req.body;
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        
        // åˆ›å»ºå¤‡ä»½
        if (fs.existsSync(DATA_FILE)) {
            const backupPath = `${BACKUP_DIR}points-data_${timestamp}.json`;
            fs.renameSync(DATA_FILE, backupPath);
        }
        
        // ä¿å­˜æ–°æ•°æ®
        fs.writeFileSync(DATA_FILE, JSON.stringify(data, null, 2));
        res.json({ status: 'success', message: 'æ•°æ®ä¸Šä¼ æˆåŠŸ' });
    } catch (error) {
        res.json({ status: 'error', message: error.message });
    }
});

// ä¸‹è½½æ•°æ®
app.get('/api/download', (req, res) => {
    try {
        if (fs.existsSync(DATA_FILE)) {
            const data = JSON.parse(fs.readFileSync(DATA_FILE, 'utf8'));
            res.json({ status: 'success', data });
        } else {
            res.json({ status: 'success', data: {} });
        }
    } catch (error) {
        res.json({ status: 'error', message: error.message });
    }
});

app.listen(5000, '0.0.0.0', () => {
    console.log('æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£5000');
});
```

### 2. å‰ç«¯é›†æˆä»£ç 

åœ¨index.htmlä¸­æ·»åŠ åŒæ­¥åŠŸèƒ½ï¼š
```javascript
// äº‘æœåŠ¡å™¨é…ç½®
const CLOUD_CONFIG = {
    serverUrl: 'https://your-server-domain.com', // æ‚¨çš„äº‘æœåŠ¡å™¨åŸŸå
    apiKey: 'your-secret-api-key' // å¯é€‰ï¼šAPIå¯†é’¥éªŒè¯
};

// äº‘åŒæ­¥å‡½æ•°
async function cloudSync(type) {
    try {
        const headers = {
            'Content-Type': 'application/json',
            ...(CLOUD_CONFIG.apiKey && { 'Authorization': `Bearer ${CLOUD_CONFIG.apiKey}` })
        };
        
        if (type === 'upload') {
            // ä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°äº‘æœåŠ¡å™¨
            const response = await fetch(`${CLOUD_CONFIG.serverUrl}/api/upload`, {
                method: 'POST',
                headers,
                body: JSON.stringify(pointsData)
            });
            
            const result = await response.json();
            if (result.status === 'success') {
                showToast('æ•°æ®å·²ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ï¼');
            } else {
                throw new Error(result.message);
            }
            
        } else if (type === 'download') {
            // ä»äº‘æœåŠ¡å™¨ä¸‹è½½æ•°æ®
            const response = await fetch(`${CLOUD_CONFIG.serverUrl}/api/download`, {
                method: 'GET',
                headers
            });
            
            const result = await response.json();
            if (result.status === 'success') {
                if (confirm('ä¸‹è½½äº‘ç«¯æ•°æ®å°†è¦†ç›–æœ¬åœ°æ•°æ®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                    pointsData = result.data;
                    saveData();
                    updateDisplay();
                    renderAchievements();
                    showToast('äº‘ç«¯æ•°æ®ä¸‹è½½æˆåŠŸï¼');
                }
            } else {
                throw new Error(result.message);
            }
        }
    } catch (error) {
        console.error('äº‘åŒæ­¥å¤±è´¥:', error);
        showToast('äº‘åŒæ­¥å¤±è´¥: ' + error.message, 'error');
    }
}

// æŸ¥çœ‹å¤‡ä»½å†å²
async function viewBackups() {
    try {
        const response = await fetch(`${CLOUD_CONFIG.serverUrl}/api/backup`, {
            method: 'GET',
            headers: {
                ...(CLOUD_CONFIG.apiKey && { 'Authorization': `Bearer ${CLOUD_CONFIG.apiKey}` })
            }
        });
        
        const result = await response.json();
        if (result.status === 'success') {
            showBackupHistory(result.backups);
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('è·å–å¤‡ä»½å¤±è´¥:', error);
        showToast('è·å–å¤‡ä»½å¤±è´¥: ' + error.message, 'error');
    }
}

// æ˜¾ç¤ºå¤‡ä»½å†å²
function showBackupHistory(backups) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center;
        z-index: 10000;
    `;
    
    let backupList = '';
    backups.forEach(backup => {
        backupList += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                <span>${backup.timestamp}</span>
                <button onclick="restoreBackup('${backup.filename}')" style="padding: 5px 10px; background: var(--success-gradient); color: white; border: none; border-radius: 5px;">æ¢å¤</button>
            </div>
        `;
    });
    
    modal.innerHTML = `
        <div style="background: var(--theme-bg); padding: 30px; border-radius: var(--border-radius); max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin-bottom: 20px; color: var(--theme-text);">ğŸ“‹ å¤‡ä»½å†å²</h3>
            <div style="margin-bottom: 20px;">
                ${backupList || '<p style="text-align: center; color: #6c757d;">æš‚æ— å¤‡ä»½è®°å½•</p>'}
            </div>
            <button onclick="closeBackupModal()" style="width: 100%; padding: 10px; background: #6c757d; color: white; border: none; border-radius: 8px;">å…³é—­</button>
        </div>
    `;
    
    document.body.appendChild(modal);
    window.closeBackupModal = () => {
        document.body.removeChild(modal);
        delete window.closeBackupModal;
    };
}

// æ¢å¤å¤‡ä»½
async function restoreBackup(filename) {
    try {
        const response = await fetch(`${CLOUD_CONFIG.serverUrl}/api/restore/${filename}`, {
            method: 'POST',
            headers: {
                ...(CLOUD_CONFIG.apiKey && { 'Authorization': `Bearer ${CLOUD_CONFIG.apiKey}` })
            }
        });
        
        const result = await response.json();
        if (result.status === 'success') {
            if (confirm(`ç¡®å®šè¦æ¢å¤åˆ° ${filename} å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚`)) {
                pointsData = result.data;
                saveData();
                updateDisplay();
                renderAchievements();
                showToast('å¤‡ä»½æ¢å¤æˆåŠŸï¼');
                window.closeBackupModal();
            }
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('æ¢å¤å¤‡ä»½å¤±è´¥:', error);
        showToast('æ¢å¤å¤‡ä»½å¤±è´¥: ' + error.message, 'error');
    }
}
```

### 3. æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬

#### Ubuntu/CentOSéƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# deploy.sh - äº‘æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬

echo "å¼€å§‹éƒ¨ç½²äº‘æœåŠ¡å™¨åŒæ­¥æœåŠ¡..."

# å®‰è£…Pythonå’ŒFlask
sudo apt update
sudo apt install python3 python3-pip -y
sudo pip3 install flask flask-cors

# åˆ›å»ºåº”ç”¨ç›®å½•
sudo mkdir -p /var/www
sudo mkdir -p /var/www/backups

# å¤åˆ¶æœåŠ¡å™¨æ–‡ä»¶
sudo cp server.py /var/www/
sudo chmod +x /var/www/server.py

# åˆ›å»ºsystemdæœåŠ¡
sudo tee /etc/systemd/system/points-sync.service > /dev/null <<EOF
[Unit]
Description=Points Data Sync Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www
ExecStart=/usr/bin/python3 /var/www/server.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable points-sync
sudo systemctl start points-sync

echo "éƒ¨ç½²å®Œæˆï¼æœåŠ¡è¿è¡Œåœ¨ç«¯å£5000"
echo "ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š"
echo "sudo systemctl status points-sync"
```

## ä¼˜åŠ¿ç‰¹ç‚¹

### âœ… æœ€ç®€å•çš„æ–¹æ¡ˆ
- 1ä¸ªAPIæœåŠ¡æ–‡ä»¶
- 1ä¸ªå‰ç«¯é›†æˆæ–‡ä»¶
- æ— éœ€æ•°æ®åº“
- æ— éœ€å¤æ‚é…ç½®

### âœ… å®Œå…¨æ§åˆ¶
- æ•°æ®å­˜å‚¨åœ¨æ‚¨çš„æœåŠ¡å™¨
- æ— ç¬¬ä¸‰æ–¹ä¾èµ–
- å®Œå…¨éšç§ä¿æŠ¤
- å¯è‡ªå®šä¹‰åŠŸèƒ½

### âœ… è‡ªåŠ¨å¤‡ä»½
- æ¯æ¬¡ä¸Šä¼ è‡ªåŠ¨å¤‡ä»½
- å†å²ç‰ˆæœ¬å¯æ¢å¤
- æ•°æ®å®‰å…¨ä¿éšœ

### âœ… å¤šè®¾å¤‡åŒæ­¥
- ä»»ä½•è®¾å¤‡è®¿é—®åŒä¸€API
- å®æ—¶æ•°æ®åŒæ­¥
- ç¦»çº¿æ”¯æŒ

## éƒ¨ç½²æ­¥éª¤ï¼ˆ20åˆ†é’Ÿå®Œæˆï¼‰

1. **ä¸Šä¼ æœåŠ¡å™¨æ–‡ä»¶** (5åˆ†é’Ÿ)
   - å°†server.pyä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨
   - è¿è¡Œéƒ¨ç½²è„šæœ¬

2. **é…ç½®åŸŸå** (5åˆ†é’Ÿ)
   - å°†APIæœåŠ¡åŸŸåæŒ‡å‘æœåŠ¡å™¨
   - é…ç½®HTTPSï¼ˆæ¨èï¼‰

3. **ä¿®æ”¹å‰ç«¯é…ç½®** (5åˆ†é’Ÿ)
   - åœ¨index.htmlä¸­é…ç½®serverUrl
   - æ·»åŠ åŒæ­¥æŒ‰é’®

4. **æµ‹è¯•åŠŸèƒ½** (5åˆ†é’Ÿ)
   - æµ‹è¯•ä¸Šä¼ ä¸‹è½½
   - éªŒè¯å¤šè®¾å¤‡åŒæ­¥

## æˆæœ¬åˆ†æ
- **æœåŠ¡å™¨æˆæœ¬**: ä½¿ç”¨ç°æœ‰äº‘æœåŠ¡å™¨ï¼ˆ0é¢å¤–è´¹ç”¨ï¼‰
- **å­˜å‚¨æˆæœ¬**: æœåŠ¡å™¨æœ¬åœ°å­˜å‚¨ï¼ˆæ— é¢å¤–è´¹ç”¨ï¼‰
- **å¸¦å®½æˆæœ¬**: ä½¿ç”¨ç°æœ‰æœåŠ¡å™¨å¸¦å®½

è¿™å°±æ˜¯æœ€ç®€å•çš„äº‘æœåŠ¡å™¨åŒæ­¥æ–¹æ¡ˆï¼æ‚¨éœ€è¦æˆ‘ç«‹å³ä¸ºæ‚¨å®ç°å—ï¼Ÿ